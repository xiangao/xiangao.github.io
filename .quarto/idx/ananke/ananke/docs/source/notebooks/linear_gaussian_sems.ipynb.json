{"title":"Linear Structural Equation Models","markdown":{"yaml":{"title":"Linear Structural Equation Models"},"headingText":"Arid Graphs","containsRefs":false,"markdown":"\n\n\n\n\nThe use of structural equation models and path analysis in causal models associated with a graph can be traced back to the works of [Sewall Wright](https://pdfs.semanticscholar.org/90bd/1ea6df6cf7ff14c392818751270b93d53d4e.pdf) and [Trygve Haavelmo](https://www.jstor.org/stable/pdf/1905714.pdf?refreqid=excelsior%3Ad280a758d3b0b296a15540bc7cf0a312). In this notebook we demonstrate how graphs can be used to postulate causal mechanisms in the presence of confounding, and provide examples of model selection, and computation of causal effects, when the causal mechanism arises as a result of a linear system of structural equations.\n\nGiven an ADMG ${\\cal G}$, the linear structural equation model (SEM) with correlated errors (corresponding to unmeasured confounding) associated with ${\\cal G}$ is defined as the set of multivariate normal distributions with covariance matrices of the form\n\n$\\Sigma = (I − B)^{-T}\\Omega(I − B)^{-1}$,\n\nwhere $\\omega_{ij} = \\omega_{ji} = 0$ unless $i \\leftrightarrow j$ exists in ${\\cal G}$, and $b_{ij} =\n0$ unless $j \\rightarrow i$ exists in ${\\cal G}$. The matrix $\\Omega$ and therefore $\\Sigma$ is assumed to be positive semi-definite. Since ${\\cal G}$ is acyclic, $B$ is assumed to be lower triangular.\n\nFollowing are the packages that need to be imported for the examples below.\n\n\n\n\nBefore going further, it is important to define the class of graphs that we will be working with because statistical models associated with arbitrary Acyclic Directed Mixed Graphs (ADMGs) are not always identified. However, it has been shown by [Drton, Foygel, and Sullivant](https://projecteuclid.org/download/pdfview_1/euclid.aos/1299680957) that SEMs associated with a certain class of ADMGs that lack convergent aborescences or C-trees, hence the coinage arid graphs, are everywhere identified. Here, we will focus on linear SEMs associated with **Maximal Arid Graphs (MArGs)** introduced by [Shpitser, Evans, and Richardson](http://auai.org/uai2018/proceedings/papers/255.pdf) and use the maximal arid projection defined therein, in order to convert a non-arid ADMG to the corresponding MArG that implies the same conditional and nested Markov constraints.\n\nConsider the non-arid graph ${\\cal G}$ below.\n\nWe can obtain the corresponding maximal arid projection ${\\cal G}^\\dagger$ like so.\n\n## Fitting and Causal Effect Estimation\n\nWe now demonstrate how to fit data originating from a system of linear structural equation models associated with an ADMG, as defined in the first section of the notebook. We first generate data according to a linear SEM associated with the MArG ${\\cal G}^\\dagger$ above.\n\nWe then check that we are able to recover the true parameters of the data generating distribution. The **LinearGaussianSEM** class has a special draw functionality to draw the associated MArG and label the parameters corresponding to each edge.\n\nWe now compute some causal effects through simple path analysis. Consider the total causal effect of $D$ on $A$ and $A$ on $D$. The former is zero as expected, and the latter is obtained as the sum of contributions through all directed paths from $A$ to $D$ and should be close to the true value of -4.5.\n\nTo demonstrate what could go wrong when we use a non-arid graph. Consider fitting the same data utilizing a model associated with the non-arid graph ${\\cal G}$ from before. We now see that our coefficient and causal estimates are now completely awry.\n\n## Model Selection\n\nHow do we pick the correct graphical model? Linear Gaussian SEMs associated with MArGs are **curved exponential families** and thus we can use the [BIC](https://en.wikipedia.org/wiki/Bayesian_information_criterion) score to test for goodness of fit. The graph ${\\cal G}^\\dagger$ implies a Verma constraint (a dormant conditional independence) where $A \\amalg D$ in the kernel and associated CADMG obtained by fixing $C$. More formally,\n\n$\\phi_C\\big(p(V); {\\cal G}^\\dagger\\big) \\equiv \\frac{p(A, B, C, D)}{p(C| {\\rm mb}(C))} = p(A, B)p(D|C)$,\n\nwhere ${\\rm mb}(C)$ is the Markov blanket of $C$. Consider a graph ${\\cal G}_s$ which is the same as ${\\cal G}^\\dagger$ but with an additional directed edge $A \\rightarrow D$. There are no conditional independences or Vermas implied by ${\\cal G}_s$. That is, the model associated with ${\\cal G}_s$ is a super model of the true model and contains one extra parameter associated with the extra directed edge. When choosing between these two hypotheses, the BIC should prefer ${\\cal G}^\\dagger$ as it is more parsimonious. Let's look at the comparison.\n\nWhat if we pick a (slightly) incorrect model where we posit that the observed correlation between $B$ and $D$ is due to a directed edge $B \\rightarrow D$ instead of confounding? The BIC should prefer any super model of the truth to an incorrect model.\n\nFinally, we consider the most interesting scenario --  a model that encodes the exact same nested Markov constraints. It turns out that two nested Markov equivalent models will be statistically indistinguishable and their BIC scores will be exactly the same.\n\nWhat we've shown here is that the BIC score can be used to select between different hyoptheses. In DAG models, a greedy search procedure was posited by [Chickering](http://www.jmlr.org/papers/volume3/chickering02b/chickering02b.pdf) that surprisingly yields a globally optimal DAG model while greedily searching through the space of equivalence classes of DAGs. Such a greedy search procedure for nested Markov models is still an open problem -- indeed the question of nested Markov equivalence in itself is still an open problem.\n","srcMarkdownNoYaml":"\n\n\n\n\nThe use of structural equation models and path analysis in causal models associated with a graph can be traced back to the works of [Sewall Wright](https://pdfs.semanticscholar.org/90bd/1ea6df6cf7ff14c392818751270b93d53d4e.pdf) and [Trygve Haavelmo](https://www.jstor.org/stable/pdf/1905714.pdf?refreqid=excelsior%3Ad280a758d3b0b296a15540bc7cf0a312). In this notebook we demonstrate how graphs can be used to postulate causal mechanisms in the presence of confounding, and provide examples of model selection, and computation of causal effects, when the causal mechanism arises as a result of a linear system of structural equations.\n\nGiven an ADMG ${\\cal G}$, the linear structural equation model (SEM) with correlated errors (corresponding to unmeasured confounding) associated with ${\\cal G}$ is defined as the set of multivariate normal distributions with covariance matrices of the form\n\n$\\Sigma = (I − B)^{-T}\\Omega(I − B)^{-1}$,\n\nwhere $\\omega_{ij} = \\omega_{ji} = 0$ unless $i \\leftrightarrow j$ exists in ${\\cal G}$, and $b_{ij} =\n0$ unless $j \\rightarrow i$ exists in ${\\cal G}$. The matrix $\\Omega$ and therefore $\\Sigma$ is assumed to be positive semi-definite. Since ${\\cal G}$ is acyclic, $B$ is assumed to be lower triangular.\n\nFollowing are the packages that need to be imported for the examples below.\n\n\n\n## Arid Graphs\n\nBefore going further, it is important to define the class of graphs that we will be working with because statistical models associated with arbitrary Acyclic Directed Mixed Graphs (ADMGs) are not always identified. However, it has been shown by [Drton, Foygel, and Sullivant](https://projecteuclid.org/download/pdfview_1/euclid.aos/1299680957) that SEMs associated with a certain class of ADMGs that lack convergent aborescences or C-trees, hence the coinage arid graphs, are everywhere identified. Here, we will focus on linear SEMs associated with **Maximal Arid Graphs (MArGs)** introduced by [Shpitser, Evans, and Richardson](http://auai.org/uai2018/proceedings/papers/255.pdf) and use the maximal arid projection defined therein, in order to convert a non-arid ADMG to the corresponding MArG that implies the same conditional and nested Markov constraints.\n\nConsider the non-arid graph ${\\cal G}$ below.\n\nWe can obtain the corresponding maximal arid projection ${\\cal G}^\\dagger$ like so.\n\n## Fitting and Causal Effect Estimation\n\nWe now demonstrate how to fit data originating from a system of linear structural equation models associated with an ADMG, as defined in the first section of the notebook. We first generate data according to a linear SEM associated with the MArG ${\\cal G}^\\dagger$ above.\n\nWe then check that we are able to recover the true parameters of the data generating distribution. The **LinearGaussianSEM** class has a special draw functionality to draw the associated MArG and label the parameters corresponding to each edge.\n\nWe now compute some causal effects through simple path analysis. Consider the total causal effect of $D$ on $A$ and $A$ on $D$. The former is zero as expected, and the latter is obtained as the sum of contributions through all directed paths from $A$ to $D$ and should be close to the true value of -4.5.\n\nTo demonstrate what could go wrong when we use a non-arid graph. Consider fitting the same data utilizing a model associated with the non-arid graph ${\\cal G}$ from before. We now see that our coefficient and causal estimates are now completely awry.\n\n## Model Selection\n\nHow do we pick the correct graphical model? Linear Gaussian SEMs associated with MArGs are **curved exponential families** and thus we can use the [BIC](https://en.wikipedia.org/wiki/Bayesian_information_criterion) score to test for goodness of fit. The graph ${\\cal G}^\\dagger$ implies a Verma constraint (a dormant conditional independence) where $A \\amalg D$ in the kernel and associated CADMG obtained by fixing $C$. More formally,\n\n$\\phi_C\\big(p(V); {\\cal G}^\\dagger\\big) \\equiv \\frac{p(A, B, C, D)}{p(C| {\\rm mb}(C))} = p(A, B)p(D|C)$,\n\nwhere ${\\rm mb}(C)$ is the Markov blanket of $C$. Consider a graph ${\\cal G}_s$ which is the same as ${\\cal G}^\\dagger$ but with an additional directed edge $A \\rightarrow D$. There are no conditional independences or Vermas implied by ${\\cal G}_s$. That is, the model associated with ${\\cal G}_s$ is a super model of the true model and contains one extra parameter associated with the extra directed edge. When choosing between these two hypotheses, the BIC should prefer ${\\cal G}^\\dagger$ as it is more parsimonious. Let's look at the comparison.\n\nWhat if we pick a (slightly) incorrect model where we posit that the observed correlation between $B$ and $D$ is due to a directed edge $B \\rightarrow D$ instead of confounding? The BIC should prefer any super model of the truth to an incorrect model.\n\nFinally, we consider the most interesting scenario --  a model that encodes the exact same nested Markov constraints. It turns out that two nested Markov equivalent models will be statistically indistinguishable and their BIC scores will be exactly the same.\n\nWhat we've shown here is that the BIC score can be used to select between different hyoptheses. In DAG models, a greedy search procedure was posited by [Chickering](http://www.jmlr.org/papers/volume3/chickering02b/chickering02b.pdf) that surprisingly yields a globally optimal DAG model while greedily searching through the space of equivalence classes of DAGs. Such a greedy search procedure for nested Markov models is still an open problem -- indeed the question of nested Markov equivalence in itself is still an open problem.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":false,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"jupyter"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../../../../styles.css"],"output-file":"linear_gaussian_sems.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.32","editor":"visual","theme":["cosmo","brand"],"title":"Linear Structural Equation Models"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}